<ion-view view-title="Appointments" class="appointment-list">
  <ion-nav-buttons side="right">
    <!--<button class="button button-icon button-clear ion-ios-search"></button>-->
  </ion-nav-buttons>
  <ion-content class="has-header" overflow-scroll="true" padding="true">
    <ion-refresher
      pulling-text="Pull to refresh..."
      on-refresh="doRefresh()">
    </ion-refresher>
    <div class="row bookmarks-container" ng-if="appointments.length==0">
      <div class="col col-center">
        <div class="empty-results">
          <i class="icon ion-ios-calendar-outline"></i>

          <h3 class="no-bookmarks">There's nothing here yet. Book an Appointment!</h3>
        </div>
      </div>
    </div>
    <div ng-repeat="appointment in appointments track by $index">
      <ul class="table-view" ng-if="appointment.status !== 'canceled'">
          <li class="table-view-cell media">
            <div class="media-body">
              <h3 class="text-center">{{appointment.title}}</h3>

              <p>Status: {{appointment.status | uppercase}}</p>

              <p>Date: {{appointment.start.date}}</p>

              <p>Time: {{appointment.start.time}}</p>
            </div>
            <table class="media-foot">
              <tr>
                <td>
                  <button class="btn btn-default btn-block" ng-click="appointmentClicked($index)">
                    <span class="icon ion-ios-calendar-outline"></span> View
                  </button>
                </td>
              </tr>
            </table>
          </li>
        </ul>
    </div>
    <ion-infinite-scroll
      immediate-check="false"
      on-infinite="loadMore()"
      spinner="spiral"
      distance="1%"
      ng-if="moreDataCanBeLoaded()">
    </ion-infinite-scroll>
  </ion-content>
</ion-view>
<script id="appointment-modal.html" type="text/ng-template">
  <ion-modal-view>
    <ion-header-bar>
      <h1 class="title">{{appointments[appointmentIndex].title}}</h1>

      <div class="buttons">
        <button style="bottom:10px;height:50px;" class="button button-icon icon ion-ios-close"
                ng-click="closeModal()"></button>
      </div>
    </ion-header-bar>

    <ion-content>
      <div class="" ng-if="appointmentState == 'standard'">
        <h4>Description: {{service.description}}</h4>
        <h4>Duration: {{service.duration}}</h4>
        <h4>Price: {{service.price}}</h4>

        <p>Date: {{appointments[appointmentIndex].start.date}}</p>

        <p>Time: {{appointments[appointmentIndex].start.time}}</p>

        <p>Associate</p>

        <div ng-click="goToProfile(employee._id)">
          <img class="employeeAvatar" ng-if="employee.provider === 'facebook'"
               ng-src="{{facebookApi}}{{employee.providerId}}/picture?type=large"/>
          <img class="employeeAvatar"
               ng-if="!employee.avatarVersion && employee.provider === 'bookd' || employee.provider === 'business'"
               ng-src="{{cloudinaryDefaultPic}}">
          <img class="employeeAvatar"
               ng-if="employee.avatarVersion && employee.provider === 'bookd' || employee.provider === 'business'"
               ng-src="{{cloudinaryBaseUrl}}{{employee.avatarVersion}}/profile/{{employee._id}}">

          <p>{{employee.name}}</p>
        </div>

        <h4 class="text-danger"
            ng-if="datePassed && appointments[appointmentIndex].status !== 'paid' && currentUser._id ===  appointments[appointmentIndex].customer._id">
          The original appointment time has passed, this appointment can no longer be updated. If you would like
          to reschedule you can
          schedule a new appointment via the Business' home page.
          Thank you.</h4>
        <h4 class="text-danger"
            ng-if="datePassed && appointments[appointmentIndex].status !== 'paid' && currentUser._id !==  appointments[appointmentIndex].customer._id">
          The original appointment time has passed, this appointment can no longer be updated.
        </h4>
        <h4 class="text-danger" ng-if=" appointments[appointmentIndex].status === 'paid' && datePassed">This service has
          been
          fulfilled and paid for, therefore it can no longer be updated. Thank you. </h4>

        <button ng-if="!datePassed" class="button button-block button-positive" ng-click="switchState('reschedule')">
          Reschedule
        </button>
        <button ng-if="!datePassed" class="button button-block button-assertive" ng-click="cancel()">
          Cancel
        </button>
      </div>
      <div class="" ng-if="appointmentState == 'reschedule'">
        <timer ng-show="showCount" countdown="countdown" max-time-unit="'minute'" interval="1000" auto-start="false"
               finish-callback="timerFinished()">Appointment being held for: {{mminutes}} minute{{minutesS}},
          {{sseconds}} second{{secondsS}}
        </timer>
        <button class="button button-block button-positive" ng-click="openDatePicker()">
          Select a date to see {{employee.name}}'s availability.
        </button>
        <ion-spinner class="text-center" ng-if="calculatingAppointments" icon="spiral"></ion-spinner>
        <div ng-if="availableTimes.length>0">
          <h3 class="text-center">{{employee.name}}'s Available Times </h3>
          <ion-item ng-repeat="time in availableTimes track by $index">
            <button class="button button-block" ng-click="createAppointmentObj(time,$index)"
                    ng-disabled="!time.available || time.status || time.toggled || time.hide"
                    ng-class="{'btn-faded-green':time.hide,'btn-gradient-red': !time.available && !time.hide
                             || time.status,'btn-gradient-green':time.available && !time.toggled && !time.hide,'btn-gradient-blue':time.toggled}"
                    role="button" class="btn" style="margin-bottom:5px;">
              {{time.time}}
            </button>
          </ion-item>
        </div>
        <button class="button button-block button-positive" ng-click="update()">
          Update Appointment
        </button>
        <button class="button button-block button-positive" ng-click="switchState('standard')">
          Back
        </button>
      </div>
    </ion-content>
  </ion-modal-view>
</script>
<!--
##
## This is what picking an associate will looks liek for schedule appointments
##
##
 -->
<!--<div class="row" style="padding-left:60px;">-->
<!--<div class="col" ng-repeat="employee in service.employees" ng-click="selectEmployee(employee)">-->
<!--<img class="employeeAvatar" ng-if="employee.provider === 'facebook'"-->
<!--ng-src="{{facebookApi}}{{employee.providerId}}/picture?type=large"/>-->
<!--<img class="employeeAvatar"-->
<!--ng-if="!employee.avatarVersion && employee.provider === 'bookd' || employee.provider === 'business'"-->
<!--ng-src="{{cloudinaryDefaultPic}}">-->
<!--<img class="employeeAvatar"-->
<!--ng-if="employee.avatarVersion && employee.provider === 'bookd' || employee.provider === 'business'"-->
<!--ng-src="{{cloudinaryBaseUrl}}{{employee.avatarVersion}}/profile/{{employee._id}}">-->
<!--<h5>{{employee.name}}</h5>-->
<!--</div>-->
<!--</div>-->
