<ion-view view-title="Appointments" class="appointment-list">
  <ion-nav-buttons side="right">
    <!--<button class="button button-icon button-clear ion-ios-search"></button>-->
  </ion-nav-buttons>
  <ion-content class="has-header" overflow-scroll="true" padding="true">
    <ion-refresher
      pulling-text="Pull to refresh..."
      on-refresh="doRefresh()">
    </ion-refresher>
    <div class="row bookmarks-container" ng-if="appointments.length==0">
      <div class="col col-center">
        <div class="empty-results">
          <i class="icon ion-ios-calendar-outline"></i>

          <h3 class="no-bookmarks">There's nothing here yet. Book an Appointment!</h3>
        </div>
      </div>
    </div>
    <div ng-repeat="appointment in appointments track by $index">
        <ul class="table-view">
          <li class="table-view-cell media">
            <div class="media-body">
              <h3 class="text-center">{{appointment.title}}</h3>

              <p>Status: {{appointment.status | uppercase}}</p>

              <p>Date: {{appointment.start.date}}</p>

              <p>Time: {{appointment.start.time}}</p>
            </div>
            <table class="media-foot">
              <tr>
                <td>
                  <button class="btn btn-default btn-block" ng-click="appointmentClicked($index)">
                    <span class="icon ion-ios-calendar-outline"></span> View
                  </button>
                </td>
              </tr>
            </table>
          </li>
        </ul>
    </div>
    <ion-infinite-scroll
      immediate-check="false"
      on-infinite="loadMore()"
      spinner="spiral"
      distance="1%"
      ng-if="moreDataCanBeLoaded()">
    </ion-infinite-scroll>
  </ion-content>
</ion-view>
<script id="appointment-modal.html" type="text/ng-template">
  <ion-modal-view>
    <ion-header-bar>
      <h1 class="title">{{appointments[appointmentIndex].title}}</h1>

      <div class="buttons">
        <button style="bottom:10px;height:50px;" class="button button-icon icon ion-ios-close"
                ng-click="closeModal()"></button>
      </div>
    </ion-header-bar>

    <ion-content>
      <div class="" ng-if="appointmentState == 'standard'">
        <h4>Description: {{service.description}}</h4>
        <h4>Duration: {{service.duration}}</h4>
        <h4>Price: {{service.price}}</h4>

        <p>Date: {{appointments[appointmentIndex].start.date}}</p>

        <p>Time: {{appointments[appointmentIndex].start.time}}</p>

        <p>Associate</p>
        <img class="employeeAvatar" ng-if="employee.provider === 'facebook'"
             ng-src="{{facebookApi}}{{employee.providerId}}/picture?type=large"/>
        <img class="employeeAvatar"
             ng-if="!employee.avatarVersion && employee.provider === 'bookd' || employee.provider === 'business'"
             ng-src="{{cloudinaryDefaultPic}}">
        <img class="employeeAvatar"
             ng-if="employee.avatarVersion && employee.provider === 'bookd' || employee.provider === 'business'"
             ng-src="{{cloudinaryBaseUrl}}{{employee.avatarVersion}}/profile/{{employee._id}}">

        <p>{{employee.name}}</p>

        <button class="button button-block button-positive" ng-click="switchState('reschedule')">
          Reschedule
        </button>
        <button class="button button-block button-assertive">
          Cancel
        </button>
      </div>
      <div class="" ng-if="appointmentState == 'reschedule'">
        <h3 class="text-center">Select an Associate</h3>
        <ion-scroll direction="x" style="width:110%; height:150px;">
          <div class="row" style="width:5000px">
            <div ng-repeat="employee in service.employees">
              <img class="employeeAvatar" ng-if="employee.provider === 'facebook'"
                   ng-src="{{facebookApi}}{{employee.providerId}}/picture?type=large"/>
              <img class="employeeAvatar"
                   ng-if="!employee.avatarVersion && employee.provider === 'bookd' || employee.provider === 'business'"
                   ng-src="{{cloudinaryDefaultPic}}">
              <img class="employeeAvatar"
                   ng-if="employee.avatarVersion && employee.provider === 'bookd' || employee.provider === 'business'"
                   ng-src="{{cloudinaryBaseUrl}}{{employee.avatarVersion}}/profile/{{employee._id}}">
              <h5>{{employee.name}}</h5>
            </div>
          </div>
        </ion-scroll>
        <button class="button button-block button-positive" ng-click="switchState('standard')">
          Back
        </button>
      </div>
    </ion-content>
  </ion-modal-view>
</script>
